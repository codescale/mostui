<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>MostUI</title>
</head>

<body>
  <!--
  <template is="dom-bind" id="#{url}">
    <highcharts-chart id="splineChart" type="spline" title="[[splineTitle]]" vs-time></highcharts-chart>
  </template>
-->

  <dom-module id="mostui-dashboard">

    <!-- Polymer -->
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <!-- Web-Components Import -->
    <link rel="import" href="/bower_components/highcharts-chart/highcharts-chart.html">
    <link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="/bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/bower_components/paper-material/paper-material.html">
    <link rel="import" href="/bower_components/neon-animation/neon-animation.html">
    <link rel="import" href="/bower_components/paper-card/paper-card.html">
    <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/bower_components/paper-fab/paper-fab.html">
    <link rel="import" href="/bower_components/paper-input/paper-input.html">
    <link rel="import" href="components/host-input.html">
    <link rel="import" href="components/dashboard-chart.html">

    <!-- JS Dependecies -->
    <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>

    <!-- Defines the element's style and local DOM -->
    <template>

      <style include="iron-flex iron-flex-alignment"></style>
      <style>
        :host {
          display: block;
          padding: 16px;
        }
        
        #addServer {
          padding: 55px;
          margin: 10px;
          width: 160px;
          height: 160px;
          border: 1px dashed grey;
          border-radius: 5px;
          color: white;
        }
      </style>

      <!--
      <div class="fullbleed layout vertical">
        <paper-header-panel class="flex" mode="seamed">
          <paper-toolbar>
            <div>Hello World!</div>
          </paper-toolbar>
        </paper-header-panel>
      </div>
      -->

      <div class="layout horizontal wrap">
        <template id="grid" is="dom-repeat" items="{{urls}}">
          <dashboard-chart url="{{item}}" index="[[index]]"></dashboard-chart>
        </template>
        <paper-icon-button id="addServer" icon="add" title="Add Chart" on-tap="addServer"></paper-icon-button>
      </div>
    </template>

    <!-- Creates the element's prototype and registers it -->
    <script>
      Polymer({
        is: 'mostui-dashboard',
        invalid: {
          type: Boolean,
          value: true
        },
        properties: {
          urls: {
            type: Object
          }
        },
        _validateHostIp: function (e) {
          var value = e.target.value;
          var pattern = /^([a-zA-Z]*|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})?$/;
          if (value && value.match(pattern) !== null) {
            return true;
          }
          return false;
        },
        addServer: function ()Â  {
          this.addSeries();
        },
        addSeries: function (url) {

          // Add URL to Dashboard
          this.urls.push(url);
          this.notifyPath("urls", this.urls.slice());
          this.$.grid.render();

          // Get new chart
          var chart = document.getElementById(this.urls.length - 1);
          // Update height
          chart._chart.options.chart.height = 160;

          // Prefill chart with data
          var data = [];
          var time = new Date().getTime();
          for (var i = 0; i < 20; i++) {
            data.push([time, 0]);
          }

          this.async(() => {

            chart.addSeries("Update", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, 'rgba(45,240,219,100)'], [1, 'rgba(255,225,50,54)']]
              }
            });
            chart.addSeries("Insert", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, 'rgba(45,240,219,100)'], [1, 'rgba(255,225,50,54)']]
              }
            });
            chart.addSeries("Delete", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, '#B3790A'], [1, '#901818']]
              }
            });
            chart.addSeries("Query", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, 'rgba(45,240,219,100)'], [1, 'rgba(255,225,50,54)']]
              }
            });
            chart.addSeries("Getmore", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, 'rgba(45,240,219,100)'], [1, 'rgba(255,225,50,54)']]
              }
            });
            chart.addSeries("Command", data, false, {
              color: {
                linearGradient: [0, 0, 0, 500],
                stops: [[0, '#0A9EB3'], [1, '#182E90']]
              }
            });
          }, 1000);
        },
        ready: function () {

          // Socket-IO
          var io = window.io();

          // Dashboard Element
          var dashboard = this;
          dashboard.urls = [];

          io.on('serverStatus', function (url, status) {

            var isUrlInDashboard = false;
            dashboard.urls.forEach((url) => {
              isUrlInDashboard = true;
              return;
            });

            if (isUrlInDashboard) {
              console.log("<%s> already displayed in Dashboard.", url);
              return;
            }

            // Configure Chart
            dashboard.splineYLabel = "Throughput";

            // Add Data-Series to chart
            dashboard.addSeries(url);
          });
        }
      });
    </script>
  </dom-module>

  <mostui-dashboard></mostui-dashboard>
</body>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="style.css">

<script type="text/javascript" src="js/libs/jquery.min.js"></script>
<script type="text/javascript" src="js/libs/angular.min.js"></script>

<script type="text/javascript" src="js/stats.js"></script>
<!--
<script type="text/javascript" src="js/app.js"></script>
<script type="text/javascript" src="js/controllers.js"></script>
<script type="text/javascript" src="js/services.js"></script>
-->

</html>